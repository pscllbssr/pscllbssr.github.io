---
import { getCollection } from 'astro:content';
import { Icon } from 'astro-icon/components';

const blogPosts = await getCollection('blog');
const sortedPosts = blogPosts.sort((a, b) => b.data.pubDate.getTime() - a.data.pubDate.getTime());

function formatDate(date: Date) {
  return new Intl.DateTimeFormat('de-DE', {
    year: 'numeric',
    month: 'long',
    day: 'numeric'
  }).format(date);
}
---

<section class="blog border-top">
  <div class="container">
    <h2>
      <Icon name="mdi:pencil" width="28" height="28" />
      Blog
    </h2>
    <p class="section-description">
      Technische Einblicke und Making-ofs meiner Recherchen und Projekte.
    </p>
    {sortedPosts.length > 0 ? (
      <ul class="blog-list">
        {sortedPosts.map((post) => (
          <li class="blog-item">
            <span class="date text-gray">{formatDate(post.data.pubDate)}</span>
            <a href={`/blog/${post.slug}`}>{post.data.title}</a>
          </li>
        ))}
      </ul>
    ) : (
      <p class="coming-soon text-gray">Beitr√§ge folgen...</p>
    )}
  </div>
</section>

<style>
  .blog {
    background: var(--color-bg-alt);
  }

  .blog-list {
    list-style: none;
    padding: 0;
    margin: 0;
    display: flex;
    flex-direction: column;
    gap: var(--spacing-sm);
  }

  .blog-item {
    display: flex;
    gap: var(--spacing-md);
    align-items: baseline;
  }

  .date {
    font-size: 0.95rem;
    min-width: 150px;
    flex-shrink: 0;
  }

  .blog-item a {
    border-bottom: none;
    text-decoration: underline;
    text-underline-offset: 2px;
    font-size: 1rem;
  }

  .coming-soon {
    font-style: italic;
    font-size: 0.95rem;
  }

  @media (max-width: 768px) {
    .blog-item {
      flex-direction: column;
      gap: var(--spacing-xs);
      align-items: flex-start;
    }

    .date {
      min-width: auto;
      font-size: 0.875rem;
    }

    .blog-item a {
      font-size: 1rem;
    }
  }
</style>
